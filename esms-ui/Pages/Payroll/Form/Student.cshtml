@page
@{
    ViewData["Title"] = "STUDENT MANAGEMENT";
    Layout = "_Layout";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h4 class="header-title">@ViewData["Title"]</h4>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12 text-right">
        <button type="button" id="openmodal" data-toggle="modal" data-target="#data_Model" class="btn btn-light font-weight-bolder">
            <i class="fas fa-plus-circle"></i> NEW
        </button>
    </div>
    <div class="col-12 mt-3">
        <div class="card pt-4 pb-4">
            <div class="card-body">
                <table id="data_table" class="table table-striped table-bordered" style="width:100%;">
                    <thead>
                        <tr>
                            <th></th>
                            <th>S#</th>
                            <th>Reg#</th>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Gender</th>
                            <th>Status</th>
                            <th>Active</th>
                            <th>Picture</th>
                        </tr>
                    </thead>
                </table>
                <div class="text-center" id="table_loading_image"><img src="~/img/brands/pro_gif.gif" alt=""></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="data_Model" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header p-3" style="background-color: #3e4676;">
                <h4 class="modal-title text-white">@ViewData["Title"]</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <form id="create_form">
                    <fieldset id="SubmitForm">
                        <!-- Top Row: Picture + Code -->
                        <div class="row form-group align-items-center">
                            <div class="col-md-2 text-center position-relative">
                                <input type="file" id="txt_picture" class="d-none" onchange="showPreview(event)">
                                <img id="img_preview" src="~/img/icons/upload-photo.png"
                                     style="width: 100%; aspect-ratio: 1; object-fit: cover; border: 2px solid #ccc; border-radius: 8px; padding: 2px; cursor: pointer;"
                                     onclick="document.getElementById('txt_picture').click()" />

                                <i class="fas fa-trash-alt text-danger position-absolute" style="bottom:8px; right:20px; cursor:pointer;" onclick="clearPreview()"></i>
                            </div>
                            <div class="col-md-10 d-flex justify-content-end align-items-center">
                             
                                <!-- generate code in modal -->
                                
                                @* <div class="input-group w-50">
                                    <input class="form-control" id="txt_code" type="text" readonly />
                                    <div class="input-group-append">
                                        <button type="button" id="btn_codegenerate" class="btn btn-outline-primary"><i class="fas fa-sync-alt"></i> Change</button>
                                    </div>
                                </div> *@

                            </div>
                        </div>

                        <!-- Basic Info -->
                        <div class="row form-group">
                            <div class="col-md-6 did-floating-label-content">
                                <input class="did-floating-input" id="txt_registrationnumber" type="text">
                                <label class="did-floating-label">Registration #</label>
                            </div>
                            <div class="col-md-6 did-floating-label-content">
                                <input class="did-floating-input" id="txt_fullname" type="text">
                                <label class="did-floating-label">Full Name</label>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-md-6 did-floating-label-content">
                                <input class="did-floating-input" id="txt_email" type="email">
                                <label class="did-floating-label">Email</label>
                            </div>
                            <div class="col-md-6 did-floating-label-content">
                                <input class="did-floating-input" id="txt_phone" type="text">
                                <label class="did-floating-label">Phone</label>
                            </div>
                        </div>

                        <!-- Gender + Dates -->
                        <div class="row form-group">
                            <div class="col-md-4 did-floating-label-content">
                                <select id="txt_gender" class="did-floating-input">
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                                <label class="did-floating-label">Gender</label>
                            </div>
                            <div class="col-md-4 did-floating-label-content">
                                <input class="did-floating-input" id="txt_dob" type="date">
                                <label class="did-floating-label">Date of Birth</label>
                            </div>
                            <div class="col-md-4 did-floating-label-content">
                                <input class="did-floating-input" id="txt_enrollmentdate" type="date">
                                <label class="did-floating-label">Enrollment Date</label>
                            </div>
                        </div>

                        <!-- Status + Exit -->
                        <div class="row form-group">
                            <div class="col-md-4 did-floating-label-content">
                                <select id="txt_enrollmentstatus" class="did-floating-input">
                                    <option value="">Select Status</option>
                                    <option value="Enrolled">Enrolled</option>
                                    <option value="Graduated">Graduated</option>
                                    <option value="Transferred">Transferred</option>
                                    <option value="Dropped">Dropped</option>
                                    <option value="Expelled">Expelled</option>
                                </select>
                                <label class="did-floating-label">Status</label>
                            </div>
                            <div class="col-md-4 did-floating-label-content">
                                <input class="did-floating-input" id="txt_exitdate" type="date">
                                <label class="did-floating-label">Exit Date</label>
                            </div>
                            <div class="col-md-4 did-floating-label-content">
                                <input class="did-floating-input" id="txt_exitreason" type="text">
                                <label class="did-floating-label">Exit Reason</label>
                            </div>
                        </div>
                        <!-- Active Checkbox Row -->
                        <div class="row form-group" >
                            <div class="col-12 text-right ">
                                <label class="custom-control custom-checkbox ;">
                                    <input type="checkbox" id="ck_act" class="custom-control-input">
                                    <span class="custom-control-label">Active</span>
                                </label>
                            </div>
                        </div>

                        <!-- Footer Row: Save & Close buttons aligned to right -->
                        <div class="row form-group">
                            <div class="col-12 text-right ">
                                <button type="button" class="btn" data-dismiss="modal" style="background-color: #2c497d; color: white;">Close</button>
                                <input id="btn_sav" type="button" value="Save" class="btn" style="background-color: #7566cc; color: white;" />
                                <input id="btn_upd" type="button" value="Update" class="btn" style="background-color: #7566cc; color: white;" />
                            </div>
                        </div>

                        <div class="d-none"><label id="txt_id"></label></div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="@Url.Content("~/AppJS/Payroll/Form/Student.js")" type="module"></script>
    <script>
        function showPreview(event) {
            const reader = new FileReader();
            reader.onload = function () {
                const output = document.getElementById('img_preview');
                output.src = reader.result;
            };
            reader.readAsDataURL(event.target.files[0]);
        }

                function clearPreview() {
            const img = document.getElementById('img_preview');
            const defaultImg = "/img/icons/upload-photo.png";

            if (img.src.includes("upload-photo.png")) {
                // Already showing default image — don't delete
                return;
            }

            img.src = defaultImg;
            document.getElementById('txt_picture').value = '';
        }
    </script>
}
